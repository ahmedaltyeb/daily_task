<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงูุชุญูู ุงูููููุฉ ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Readex+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <!-- Chosen Palette: Professional Blue on White Background -->
    <!-- Application Structure Plan: ุชู ุชุตููู ุงูุชุทุจูู ูููุญุฉ ุชุญูู (Dashboard) ุชูุงุนููุฉ ูู ุตูุญุฉ ูุงุญุฏุฉ. ูุจุฏุฃ ุจุงุณุชุนุฑุงุถ ุงูุงุณุชุฑุงุชูุฌูุฉ ุงูุนุงูุฉ (ุงููุณุงุฑูู) ูุน ุฑุณู ุจูุงูู ูุชูุฒูุน ุงูููุช. ุงูุฌุฒุก ุงูุฑุฆูุณู ูู "ููุญุฉ ุงูุชุญูู ุงูุฃุณุจูุนูุฉ" ุงูุชูุงุนููุฉุ ุญูุซ ูููู ูููุณุชุฎุฏู ุงูููุฑ ุนูู ุฃู ููู ูู ุฃูุงู ุงูุฃุณุจูุน ูุนุฑุถ ุชูุงุตูู ุฎุทุชู ุงูููููุฉ ุฏููุงูููููุง ูู ููุญุฉ ูุฌุงูุฑุฉ. ููู ุฐูู ุนุฑุถ ูุฑุฆู ูููููู ุงููููู ุงูููุชุฑุญ ูุชุฑุณูุฎ ุงูุฑูุชููุ ูููุชูู ุงูุชุทุจูู ุจูุงุฆูุฉ ููุงุชูุญ ุงููุฌุงุญ. ูุฐุง ุงููููู ูุชุจุน ุชุฏูููุง ููุทูููุง ูู ุงูุนุงู ุฅูู ุงูุฎุงุตุ ููุง ูุณูู ุนูู ุงููุณุชุฎุฏู ููู ุงูุฎุทุฉ ูุงูุชูุงุนู ูุนูุง ุจุฏูุงู ูู ูุฑุงุกุชูุง ุจุดูู ุณูุจู. -->
    <!-- Visualization & Content Choices: 1. ุชูุฒูุน ุงูููุช ุงูุฃุณุจูุนู -> Goal: Inform -> Viz: Donut Chart -> Interaction: Hover -> Justification: ุฃุณุฑุน ูู ุงูููู ูู ุงููุต -> Library: Chart.js. 2. ุฌุฏูู ุงูุชุฎุทูุท ุงูุฃุณุจูุนู -> Goal: Organize/Explore -> Viz: Interactive buttons for each day + details panel -> Interaction: Click to update details -> Justification: ุฃูุซุฑ ุชูุงุนููุฉ ูุฌุงุฐุจูุฉ ูู ุฌุฏูู ุซุงุจุชุ ูููู ูู ุงูููุถู ุงูุจุตุฑูุฉ -> Method: Vanilla JS DOM manipulation. 3. ุงููููู ุงููููู -> Goal: Reinforce -> Viz: HTML/CSS Flowchart -> Interaction: None -> Justification: ุชูุซูู ูุฑุฆู ุฎููู ููุฑูุชูู ุงููููู ุจุฏูู ููุชุจุงุช ุฎุงุฑุฌูุฉ -> Method: HTML + Tailwind CSS. 4. ุงููุตูุต (ุงูุงุณุชุฑุงุชูุฌูุฉุ ููุงุชูุญ ุงููุฌุงุญ) -> Goal: Inform/Motivate -> Viz: Styled cards -> Interaction: None -> Justification: ุนุฑุถ ุงููุญุชูู ุงููุตู ุจุทุฑููุฉ ููุธูุฉ ูุฌุฐุงุจุฉ ุจุตุฑููุง -> Method: HTML + Tailwind CSS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script>
        // Set theme on initial load
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
    </script>
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #ffffff; /* White background for light mode */
            color: #111827; /* Darker text for light mode */
        }
        html.dark body {
            background-color: #111827; /* Darker background for dark mode */
            color: #d1d5db; /* Lighter text for dark mode */
        }
        html[lang="en"] body {
            font-family: 'Readex Pro', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        .task-chart-container {
             position: relative;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .active-day {
            background-color: #2563eb !important; /* Blue color */
            color: #FFFFFF !important;
            border-color: #2563eb !important; /* Blue color */
        }
        html.dark .active-day {
            background-color: #c5a691 !important;
            border-color: #c5a691 !important;
            color: #1a202c !important;
        }
        .flowchart-step {
            transition: all 0.3s ease;
        }
        .flowchart-arrow {
            color: #cbd5e1;
        }
        .table-container::-webkit-scrollbar {
            height: 8px;
        }
        .table-container::-webkit-scrollbar-track {
            background: #f9fafb; /* Light gray track */
        }
        html.dark .table-container::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        .modal-backdrop, #tasks-table-body, .toast-notification {
            transition: all 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .spinner {
            border-top-color: #2563eb; /* Blue color */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .pdf-styles {
            background-color: white !important;
            color: black !important;
            font-family: 'Tajawal', sans-serif;
        }
        .pdf-styles h1, .pdf-styles h2, .pdf-styles h3, .pdf-styles th {
            color: black !important;
        }
        .pdf-styles td, .pdf-styles li {
            color: #333 !important;
        }
        .watermark {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 14px;
            font-weight: 500;
            color: #000000;
            opacity: 0.1;
            pointer-events: none;
            transform: rotate(-15deg);
            z-index: 1000;
        }
        html.dark .watermark {
            color: #ffffff;
            opacity: 0.05;
        }
    </style>
</head>
<body class="dark:bg-gray-900 dark:text-gray-200">
    <div class="watermark">ahmed_eltyeb</div>

    <div class="relative container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        
        <div class="absolute top-4 left-4 z-20 flex items-center space-x-2" dir="ltr">
            <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 10.607a1 1 0 010-1.414l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM3 11a1 1 0 100-2H2a1 1 0 100 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
            </button>
            <button id="lang-switcher" class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                English
            </button>
        </div>

        <header class="text-center my-10">
            <h1 data-key="mainTitle" class="text-3xl sm:text-4xl font-bold text-blue-600 dark:text-[#c5a691]">ููุญุฉ ุงูุชุญูู ุงูููููุฉ ุงูุชูุงุนููุฉ</h1>
            <p data-key="mainSubtitle" class="mt-2 text-md sm:text-lg text-gray-600 dark:text-gray-400">ุฎุทุชู ุงููุชูุงููุฉ ูุชุญููู ุฃูุฏุงูู ุงูููููุฉ ุจููุงุกุฉ ูุชุฑููุฒ</p>
        </header>

        <main class="space-y-12">

            <!-- Section 1: Strategy & Time Distribution -->
            <section id="strategy" class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                <h2 data-key="strategyTitle" class="text-2xl font-bold text-center mb-6 text-blue-600 dark:text-[#c5a691]">1. ุงูุชุญููู ุงูุงุณุชุฑุงุชูุฌู: ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุงุฑูู</h2>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="text-base leading-relaxed">
                        <p data-key="strategyDesc" class="mb-4">ุงูุชุญุฏู ุงูุฃูุจุฑ ูู ุฃู ุฃูุฏุงูู ุงููุธูููุฉ ุชููุณู ุฅูู ูุฌุงููู ูุฎุชูููู. ูุฐุงุ ุชู ุชุตููู **"ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุงุฑูู"** ูุชูุฏูู ููุณู ูุฎุจูุฑ ูู ูู ูุฌุงู ุนูู ุญุฏุฉุ ููุง ูุฒูุฏ ูู ูุฑุต ูุฌุงุญู ุจุดูู ูุจูุฑ.</p>
                        <div class="space-y-4">
                            <div class="p-4 border-r-4 border-blue-600 dark:border-[#c5a691] bg-gray-50 dark:bg-gray-900 rounded-lg direction-border">
                                <h3 data-key="techTrack" class="font-bold text-lg">ุงููุณุงุฑ ุงูุชููู</h3>
                                <p data-key="techTrackDesc" class="text-sm">ูุฑูุฒ ุนูู ูุธุงุฆู (Software Developer, Application Administrator) ููุชุทูุจ ุณูุฑุฉ ุฐุงุชูุฉ ุชูููุฉ ููุนุฑุถ ุฃุนูุงู ููู.</p>
                            </div>
                            <div class="p-4 border-r-4 border-teal-500 dark:border-[#a3b1a3] bg-gray-50 dark:bg-gray-900 rounded-lg direction-border">
                                <h3 data-key="commTrack" class="font-bold text-lg">ุงููุณุงุฑ ุงูุชูุงุตูู</h3>
                                <p data-key="commTrackDesc" class="text-sm">ูุฑูุฒ ุนูู ูุธุงุฆู (Digital Marketing, Customer Service) ููุชุทูุจ ุณูุฑุฉ ุฐุงุชูุฉ ุชุจุฑุฒ ููุงุฑุงุช ุงูุชูุงุตู ูุญู ุงููุดููุงุช.</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 data-key="weeklyDistTitle" class="text-xl font-bold text-center mb-4 text-gray-700 dark:text-gray-300">ุชูุฒูุน ุงูููุช ุงูุฃุณุจูุนู ุงูููุชุฑุญ</h3>
                        <div class="chart-container">
                            <canvas id="weeklyDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: Interactive Weekly Dashboard -->
            <section id="dashboard" class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                <h2 data-key="dashboardTitle" class="text-2xl font-bold text-center mb-6 text-blue-600 dark:text-[#c5a691]">2. ููุญุฉ ุงูุชุญูู ุงูุฃุณุจูุนูุฉ</h2>
                <p data-key="dashboardDesc" class="text-center text-gray-600 dark:text-gray-400 mb-6 max-w-2xl mx-auto">ููุง ุชููู ููุฉ ุฎุทุชู. ุงููุฑ ุนูู ุฃู ููู ูู ุฃูุงู ุงูุฃุณุจูุน ูุนุฑุถ ุฎุทุชู ุงูุชูุตูููุฉ ูุงูููุงู ุงููุฎุตุตุฉ ูู.</p>
                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="lg:w-1/4">
                        <h3 data-key="selectDay" class="font-bold text-lg text-center mb-4">ุงุฎุชุฑ ูููุงู</h3>
                        <div id="day-selector" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-1 gap-3">
                             <button data-day="monday" class="day-btn p-3 w-full text-center font-semibold border-2 border-gray-200 dark:border-gray-700 rounded-lg transition-all duration-300 hover:bg-blue-600 hover:text-white" data-key="monday">ุงูุงุซููู</button>
                            <button data-day="tuesday" class="day-btn p-3 w-full text-center font-semibold border-2 border-gray-200 dark:border-gray-700 rounded-lg transition-all duration-300 hover:bg-blue-600 hover:text-white" data-key="tuesday">ุงูุซูุงุซุงุก</button>
                            <button data-day="wednesday" class="day-btn p-3 w-full text-center font-semibold border-2 border-gray-200 dark:border-gray-700 rounded-lg transition-all duration-300 hover:bg-blue-600 hover:text-white" data-key="wednesday">ุงูุฃุฑุจุนุงุก</button>
                            <button data-day="thursday" class="day-btn p-3 w-full text-center font-semibold border-2 border-gray-200 dark:border-gray-700 rounded-lg transition-all duration-300 hover:bg-blue-600 hover:text-white" data-key="thursday">ุงูุฎููุณ</button>
                            <button data-day="friday" class="day-btn p-3 w-full text-center font-semibold border-2 border-gray-200 dark:border-gray-700 rounded-lg transition-all duration-300 hover:bg-blue-600 hover:text-white" data-key="friday">ุงูุฌูุนุฉ</button>
                            <button data-day="saturday" class="day-btn p-3 w-full text-center font-semibold border-2 border-gray-200 dark:border-gray-700 rounded-lg transition-all duration-300 hover:bg-blue-600 hover:text-white" data-key="saturday">ุงูุณุจุช</button>
                            <button data-day="sunday" class="day-btn p-3 w-full text-center font-semibold border-2 border-gray-200 dark:border-gray-700 rounded-lg transition-all duration-300 hover:bg-blue-600 hover:text-white col-span-2 sm:col-span-1 lg:col-span-1" data-key="sunday">ุงูุฃุญุฏ</button>
                        </div>
                    </div>
                    <div class="lg:w-3/4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
                        <h3 id="plan-title" class="text-xl font-bold mb-4 text-blue-500 dark:text-[#a3b1a3]"></h3>
                        
                        <!-- Tasks Table Section -->
                        <div class="w-full">
                            <div class="flex justify-between items-center mb-2">
                                <h4 data-key="tasksList" class="font-semibold text-gray-700 dark:text-gray-300">ูุงุฆูุฉ ุงูููุงู:</h4>
                                <div class="flex items-center space-x-2">
                                    <button id="import-btn" title="Import Tasks from CSV" class="text-blue-600 dark:text-[#c5a691] rounded-full w-8 h-8 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                                    </button>
                                    <button id="ai-priority-btn" title="Suggest Priorities with AI" class="text-blue-600 dark:text-[#c5a691] rounded-full w-8 h-8 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></button>
                                    <button id="add-task-btn" class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-blue-700 dark:bg-[#c5a691] dark:text-gray-900 dark:hover:bg-[#d4b9a4] transition shadow text-xl font-light">+</button>
                                </div>
                            </div>
                            <div class="table-container overflow-x-auto">
                                <table class="w-full min-w-[600px] text-sm text-gray-500 dark:text-gray-400 direction-text">
                                    <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-4 py-3" data-key="colCompleted">ุฃููุฌุฒุช</th>
                                            <th scope="col" class="px-6 py-3" data-key="colTask">ุงููููุฉ</th>
                                            <th scope="col" class="px-2 py-3" data-key="colNotes">ููุงุญุธุงุช</th>
                                            <th scope="col" class="px-6 py-3" data-key="colPriority">ุงูุฃููููุฉ</th>
                                            <th scope="col" class="px-6 py-3" data-key="colStatus">ุงูุญุงูุฉ</th>
                                            <th scope="col" class="px-6 py-3" data-key="colTime">ุงูููุช</th>
                                            <th scope="col" class="px-4 py-3"><span class="sr-only" data-key="colDelete">ุญุฐู</span></th>
                                        </tr>
                                    </thead>
                                    <tbody id="tasks-table-body" class="transition-opacity duration-300">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Analysis and Notes Section -->
                        <div class="mt-8 grid md:grid-cols-2 gap-6 border-t border-gray-200 dark:border-gray-700 pt-6">
                             <div>
                                <h4 data-key="tasksAnalysis" class="font-semibold text-gray-700 dark:text-gray-300 mb-2 text-center">ุชุญููู ุงูููุงู:</h4>
                                <div class="task-chart-container">
                                    <canvas id="taskAnalysisChart"></canvas>
                                </div>
                                <button id="ai-summary-btn" class="mt-4 w-full bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600 transition text-sm flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                    <span data-key="aiSummaryBtn">ูุฎูุต ุฅูุฌุงุฒุงุชู</span>
                                </button>
                            </div>
                            <div>
                                <h4 data-key="dailyNotesTitle" class="font-semibold text-gray-700 dark:text-gray-300 mb-2 text-center">ููุงุญุธุงุช ุงูููู</h4>
                                <textarea id="daily-notes-textarea" rows="4" class="w-full h-40 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm p-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section 3: Daily Structure -->
            <section id="structure" class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                <h2 data-key="dailyStructureTitle" class="text-2xl font-bold text-center mb-6 text-blue-600 dark:text-[#c5a691]">3. ุงููููู ุงููููู ุงูููุชุฑุญ</h2>
                 <p data-key="dailyStructureDesc" class="text-center text-gray-600 dark:text-gray-400 mb-8 max-w-2xl mx-auto">ูุฐุง ูู ุชุฏูู ุงูุนูู ุงููููู ุงูููุตู ุจู ูุชุญููู ุฃูุตู ุงุณุชูุงุฏุฉ ูู ุทุงูุชู ูุชุฑููุฒู ุฎูุงู ุงูููู.</p>
                <div class="flex flex-col md:flex-row justify-center items-center md:items-start gap-4 md:gap-0">
                    <div class="flowchart-step text-center p-4">
                        <div class="text-4xl mb-2">โ๏ธ</div>
                        <h3 data-key="morning" class="font-bold">ุงูุตุจุงุญ</h3>
                        <p data-key="morningDesc" class="text-sm text-gray-500 dark:text-gray-400">ุทุงูุฉ ูุชุฑููุฒ ุนุงูู</p>
                        <div class="mt-2 p-2 bg-amber-100 text-amber-800 rounded-md text-sm font-semibold" data-key="morningTask">ุงูุจุญุซ ุนู ูุธููุฉ</div>
                    </div>
                    <div class="mt-8 md:mt-12 text-4xl flowchart-arrow transform md:-rotate-90">โ</div>
                    <div class="flowchart-step text-center p-4">
                        <div class="text-4xl mb-2">๐</div>
                        <h3 data-key="afternoon" class="font-bold">ุงูุธููุฑุฉ</h3>
                        <p data-key="afternoonDesc" class="text-sm text-gray-500 dark:text-gray-400">ุชุนูู ูุชุทุจูู</p>
                        <div class="mt-2 p-2 bg-sky-100 text-sky-800 rounded-md text-sm font-semibold" data-key="afternoonTask">ุชุทููุฑ ุงูููุงุฑุงุช</div>
                    </div>
                     <div class="mt-8 md:mt-12 text-4xl flowchart-arrow transform md:-rotate-90">โ</div>
                    <div class="flowchart-step text-center p-4">
                        <div class="text-4xl mb-2">๐</div>
                        <h3 data-key="evening" class="font-bold">ุงููุณุงุก</h3>
                        <p data-key="eveningDesc" class="text-sm text-gray-500 dark:text-gray-400">ุงุณุชูุนุงุจ ูููุงุฑุณุฉ</p>
                        <div class="mt-2 p-2 bg-indigo-100 text-indigo-800 rounded-md text-sm font-semibold" data-key="eveningTask">ุชุญุณูู ุงููุบุฉ</div>
                    </div>
                     <div class="mt-8 md:mt-12 text-4xl flowchart-arrow transform md:-rotate-90">โ</div>
                     <div class="flowchart-step text-center p-4">
                        <div class="text-4xl mb-2">๐</div>
                        <h3 data-key="endOfDay" class="font-bold">ููุงูุฉ ุงูููู</h3>
                        <p data-key="endOfDayDesc" class="text-sm text-gray-500 dark:text-gray-400">ูุฑุงุฌุนุฉ ูุชุฎุทูุท</p>
                        <div class="mt-2 p-2 bg-slate-100 text-slate-800 rounded-md text-sm font-semibold" data-key="endOfDayTask">ุงูุชุฎุทูุท ููุบุฏ</div>
                    </div>
                </div>
            </section>

            <!-- Section 4: Reports -->
            <section id="reports" class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                <h2 data-key="reportsTitle" class="text-2xl font-bold text-center mb-6 text-blue-600 dark:text-[#c5a691]">4. ุงูุชูุงุฑูุฑ</h2>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                    <button id="weekly-report-btn" class="w-full sm:w-auto bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>
                        <span data-key="weeklyReportBtn">ุชูุฑูุฑ ุฃุณุจูุนู</span>
                    </button>
                    <button id="monthly-report-btn" class="w-full sm:w-auto bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M_REMOVED_" /></svg>
                        <span data-key="monthlyReportBtn">ุชูุฑูุฑ ุดูุฑู</span>
                    </button>
                </div>
            </section>

            <!-- Section 5: Keys to Success -->
            <section id="keys" class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                <h2 data-key="keysTitle" class="text-2xl font-bold text-center mb-6 text-blue-600 dark:text-[#c5a691]">5. ููุงุชูุญ ุงููุฌุงุญ</h2>
                <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <h3 data-key="keyCommitment" class="font-bold mb-2">ุงูุงูุชุฒุงู</h3>
                        <p data-key="keyCommitmentDesc" class="text-sm text-gray-600 dark:text-gray-400">ุงูุงูุชุฒุงู ุจุงูุฎุทุฉ ููุฏุฉ ุฃุณุจูุนูู ุณูุฌุนููุง ุนุงุฏุฉ ููููุฉ ุณููุฉ.</p>
                    </div>
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <h3 data-key="keyProjects" class="font-bold mb-2">ุงููุดุงุฑูุน</h3>
                        <p data-key="keyProjectsDesc" class="text-sm text-gray-600 dark:text-gray-400">ูุนุฑุถ ุฃุนูุงูู ุงูุชููู ูู ุฃููู ุฃุฏุงุฉ ูุฅุซุจุงุช ููุงุฑุงุชู.</p>
                    </div>
                     <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <h3 data-key="keyShowcase" class="font-bold mb-2">ุงูุฅุธูุงุฑ</h3>
                        <p data-key="keyShowcaseDesc" class="text-sm text-gray-600 dark:text-gray-400">ุฃุซุจุช ููุงุฑุงุชู ุงูุชูุงุตููุฉ ูู ุฎูุงู ููู LinkedIn ุงุญุชุฑุงูู ููุญุชูู ูุงุฏู.</p>
                    </div>
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <h3 data-key="keyFlexibility" class="font-bold mb-2">ุงููุฑููุฉ</h3>
                        <p data-key="keyFlexibilityDesc" class="text-sm text-gray-600 dark:text-gray-400">ุงูุฎุทุฉ ูู ุฅุทุงุฑ ุนูู ูููุณุช ูููุฏุงู. ูู ุจุชุนุฏูููุง ุญุณุจ ุงูุธุฑูู.</p>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="text-center mt-12 py-6 border-t border-gray-200 dark:border-gray-700">
            <p data-key="footer" class="text-gray-500 dark:text-gray-400">ุชู ุชุตููู ููุญุฉ ุงูุชุญูู ูุฐู ููุณุงุนุฏุชู ุนูู ุชูุธูู ุฑุญูุชู ุงูููููุฉ. ุจุงูุชูููู!</p>
            <div class="mt-4">
                <a href="https://wa.me/1234567890" target="_blank" rel="noopener noreferrer" class="inline-flex items-center space-x-2 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.269.654 4.547 1.96 6.344l-1.379 5.021 5.15-1.359z" /></svg>
                    <span data-key="contactMe">ุชูุงุตู ูุนู ุนุจุฑ ูุงุชุณุงุจ</span>
                </a>
            </div>
             <div class="mt-6">
                <p class="text-xs text-gray-400" data-key="designedBy">Designed by Ahmed Eltyeb Khalifa</p>
            </div>
        </footer>
    </div>

    <!-- Modals Container -->
    <div id="modal-container">
        <!-- Add/Edit Task Modal -->
        <div id="add-task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-30 opacity-0 pointer-events-none modal-backdrop">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 modal-content scale-95 transform">
                <div class="flex justify-between items-center mb-4">
                    <h3 data-key="modalTitle" class="text-xl font-bold text-blue-600 dark:text-[#c5a691]">ุฅุถุงูุฉ ูููุฉ ุฌุฏูุฏุฉ</h3>
                    <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">&times;</button>
                </div>
                <form id="add-task-form">
                     <div class="space-y-4">
                        <div>
                            <label for="task-name" data-key="modalTaskName" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ุงุณู ุงููููุฉ</label>
                            <input type="text" id="task-name" name="task-name" required class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200">
                        </div>
                        <div>
                            <label for="task-category" data-key="modalCategory" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ุงููุฆุฉ</label>
                            <input type="text" id="task-category" name="task-category" required class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200">
                        </div>
                         <div>
                            <label for="task-notes" data-key="colNotes" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ููุงุญุธุงุช</label>
                            <textarea id="task-notes" name="task-notes" rows="2" class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="task-date" data-key="modalTaskDate" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ุงูุชุงุฑูุฎ</label>
                                <input type="date" id="task-date" name="task-date" required class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200">
                            </div>
                            <div>
                                <label for="task-time" data-key="modalTaskTime" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ุงูููุช</label>
                                <input type="time" id="task-time" name="task-time" required class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200">
                            </div>
                        </div>
                        <div>
                            <label for="task-priority" data-key="modalPriority" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ุงูุฃููููุฉ</label>
                            <select id="task-priority" name="task-priority" class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200">
                                <option value="high" data-key="priorityHigh">ุนุงููุฉ</option>
                                <option value="medium" data-key="priorityMedium">ูุชูุณุทุฉ</option>
                                <option value="low" data-key="priorityLow">ููุฎูุถุฉ</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-between items-center">
                        <button type="button" id="ai-generate-tasks-btn" title="Generate tasks with AI" class="text-indigo-500 hover:text-indigo-700 dark:text-indigo-400 dark:hover:text-indigo-300 transition flex items-center space-x-2">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                             <span data-key="aiGenerateBtn">ุชูููุฏ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู</span>
                        </button>
                        <button type="submit" data-key="modalAddTaskBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 dark:bg-[#a3b1a3] dark:text-gray-900 dark:hover:bg-[#b8c2b8] transition">ุฅุถุงูุฉ ุงููููุฉ</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Import Modal -->
        <div id="import-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-30 opacity-0 pointer-events-none modal-backdrop">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 modal-content scale-95 transform">
                <div class="flex justify-between items-center mb-4">
                    <h3 data-key="modalImportTitle" class="text-xl font-bold text-blue-600 dark:text-[#c5a691]">ุงุณุชูุฑุงุฏ ุงูููุงู ูู CSV</h3>
                    <button id="close-import-modal-btn" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">&times;</button>
                </div>
                <form id="import-form">
                    <p data-key="importInstructions" class="text-sm text-gray-500 dark:text-gray-400 mb-4 bg-yellow-50 dark:bg-yellow-900/50 p-3 rounded-lg border-l-4 border-yellow-400 direction-border">ุชุฃูุฏ ูู ุฃู ููู CSV ูุญุชูู ุนูู ุงูุฃุนูุฏุฉ ุงูุชุงููุฉ ุจุงูุชุฑุชูุจ: task, category, priority (high/medium/low), notes, date (YYYY-MM-DD), time (HH:MM).</p>
                    <div>
                        <label for="csv-file" data-key="selectFile" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ุงุฎุชุฑ ููู CSV</label>
                        <input type="file" id="csv-file" name="csv-file" accept=".csv" required class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-gray-700 dark:file:text-gray-300 dark:hover:file:bg-gray-600"/>
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button type="submit" data-key="importTasksBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 dark:bg-[#a3b1a3] dark:text-gray-900 dark:hover:bg-[#b8c2b8] transition">ุงุณุชูุฑุงุฏ ุงูููุงู</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- AI Summary/Loading Modal -->
        <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-40 opacity-0 pointer-events-none modal-backdrop">
             <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 modal-content scale-95 transform text-center">
                <div id="ai-loading" class="hidden">
                     <div class="spinner w-12 h-12 rounded-full border-4 border-gray-200 dark:border-gray-600 mx-auto"></div>
                     <p data-key="aiLoading" class="mt-4 text-lg">ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูููุฑ...</p>
                </div>
                <div id="ai-summary-content" class="hidden">
                    <h3 data-key="aiSummaryTitle" class="text-xl font-bold text-blue-600 dark:text-[#c5a691] mb-4">ููุฎุต ุฅูุฌุงุฒุงุชู</h3>
                    <p id="ai-summary-text" class="text-gray-600 dark:text-gray-300"></p>
                    <button id="close-ai-modal-btn" class="mt-6 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 dark:bg-[#a3b1a3] dark:text-gray-900 dark:hover:bg-[#b8c2b8] transition" data-key="aiCloseBtn">ุฅุบูุงู</button>
                </div>
            </div>
        </div>
        
        <!-- Notes Modal -->
        <div id="notes-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-40 opacity-0 pointer-events-none modal-backdrop">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 modal-content scale-95 transform">
                <div class="flex justify-between items-center mb-4">
                    <h3 data-key="modalNotesTitle" class="text-xl font-bold text-blue-600 dark:text-[#c5a691]">ููุงุญุธุงุช ุงููููุฉ</h3>
                    <button id="close-notes-modal-btn" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">&times;</button>
                </div>
                <form id="notes-form">
                    <input type="hidden" id="notes-task-id">
                    <textarea id="task-notes-textarea" rows="5" class="w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm p-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200"></textarea>
                    <div class="mt-4 flex justify-end">
                        <button type="submit" data-key="saveNotesBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 dark:bg-[#a3b1a3] dark:text-gray-900 dark:hover:bg-[#b8c2b8] transition">ุญูุธ ุงูููุงุญุธุงุช</button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Report Modal -->
        <div id="report-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-40 opacity-0 pointer-events-none modal-backdrop">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl modal-content scale-95 transform flex flex-col" style="height: 90vh;">
                <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center flex-shrink-0">
                    <h3 id="report-modal-title" class="text-xl font-bold text-blue-600 dark:text-[#c5a691]"></h3>
                    <button id="close-report-modal-btn" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto flex-grow">
                    <div id="report-content-to-print">
                        <!-- Report content will be injected here -->
                    </div>
                </div>
                <div class="p-4 border-t dark:border-gray-700 flex justify-end flex-shrink-0">
                    <button id="download-pdf-btn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        <span data-key="downloadPdfBtn">ุชุญููู ูู PDF</span>
                    </button>
                </div>
            </div>
        </div>

    </div>
    
    <!-- Toast Notification -->
    <div id="toast-notification" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg transform translate-y-20 opacity-0 toast-notification z-50">
        <p id="toast-message"></p>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
    
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDNsYudNSDHE8cyzNnfT9gxNWUhb6Yz4Uc",
            authDomain: "my-tasks-dashboard.firebaseapp.com",
            projectId: "my-tasks-dashboard",
            storageBucket: "my-tasks-dashboard.appspot.com",
            messagingSenderId: "45960229158",
            appId: "1:45960229158:web:ce37bfd62aeacc081211e7",
            measurementId: "G-QMNYBQJ6NG"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function () {

            let currentLang = 'ar';
            let currentDay = 'monday';
            let weeklyDistributionChart, taskAnalysisChart;
            let unsubscribe; 

            const translations = {
                ar: {
                    langSwitch: "English", mainTitle: "ููุญุฉ ุงูุชุญูู ุงูููููุฉ ุงูุชูุงุนููุฉ", mainSubtitle: "ุฎุทุชู ุงููุชูุงููุฉ ูุชุญููู ุฃูุฏุงูู ุงูููููุฉ ุจููุงุกุฉ ูุชุฑููุฒ",
                    strategyTitle: "1. ุงูุชุญููู ุงูุงุณุชุฑุงุชูุฌู: ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุงุฑูู", strategyDesc: "ุงูุชุญุฏู ุงูุฃูุจุฑ ูู ุฃู ุฃูุฏุงูู ุงููุธูููุฉ ุชููุณู ุฅูู ูุฌุงููู ูุฎุชูููู. ูุฐุงุ ุชู ุชุตููู **\"ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุงุฑูู\"** ูุชูุฏูู ููุณู ูุฎุจูุฑ ูู ูู ูุฌุงู ุนูู ุญุฏุฉุ ููุง ูุฒูุฏ ูู ูุฑุต ูุฌุงุญู ุจุดูู ูุจูุฑ.",
                    techTrack: "ุงููุณุงุฑ ุงูุชููู", techTrackDesc: "ูุฑูุฒ ุนูู ูุธุงุฆู (Software Developer, Application Administrator) ููุชุทูุจ ุณูุฑุฉ ุฐุงุชูุฉ ุชูููุฉ ููุนุฑุถ ุฃุนูุงู ููู.",
                    commTrack: "ุงููุณุงุฑ ุงูุชูุงุตูู", commTrackDesc: "ูุฑูุฒ ุนูู ูุธุงุฆู (Digital Marketing, Customer Service) ููุชุทูุจ ุณูุฑุฉ ุฐุงุชูุฉ ุชุจุฑุฒ ููุงุฑุงุช ุงูุชูุงุตู ูุญู ุงููุดููุงุช.",
                    weeklyDistTitle: "ุชูุฒูุน ุงูููุช ุงูุฃุณุจูุนู ุงูููุชุฑุญ", dashboardTitle: "2. ููุญุฉ ุงูุชุญูู ุงูุฃุณุจูุนูุฉ", dashboardDesc: "ููุง ุชููู ููุฉ ุฎุทุชู. ุงููุฑ ุนูู ุฃู ููู ูู ุฃูุงู ุงูุฃุณุจูุน ูุนุฑุถ ุฎุทุชู ุงูุชูุตูููุฉ ูุงูููุงู ุงููุฎุตุตุฉ ูู.",
                    selectDay: "ุงุฎุชุฑ ูููุงู", monday: "ุงูุงุซููู", tuesday: "ุงูุซูุงุซุงุก", wednesday: "ุงูุฃุฑุจุนุงุก", thursday: "ุงูุฎููุณ", friday: "ุงูุฌูุนุฉ", saturday: "ุงูุณุจุช", sunday: "ุงูุฃุญุฏ",
                    tasksList: "ูุงุฆูุฉ ุงูููุงู:", colCompleted: "ุฃููุฌุฒุช", colTask: "ุงููููุฉ", colCategory: "ุงููุฆุฉ", colPriority: "ุงูุฃููููุฉ", colStatus: "ุงูุญุงูุฉ", colDelete: "ุญุฐู", colNotes: "ููุงุญุธุงุช", colTime: "ุงูููุช",
                    tasksAnalysis: "ุชุญููู ุงูููุงู:", dailyStructureTitle: "3. ุงููููู ุงููููู ุงูููุชุฑุญ", dailyStructureDesc: "ูุฐุง ูู ุชุฏูู ุงูุนูู ุงููููู ุงูููุตู ุจู ูุชุญููู ุฃูุตู ุงุณุชูุงุฏุฉ ูู ุทุงูุชู ูุชุฑููุฒู ุฎูุงู ุงูููู.",
                    morning: "ุงูุตุจุงุญ", morningDesc: "ุทุงูุฉ ูุชุฑููุฒ ุนุงูู", morningTask: "ุงูุจุญุซ ุนู ูุธููุฉ", afternoon: "ุงูุธููุฑุฉ", afternoonDesc: "ุชุนูู ูุชุทุจูู", afternoonTask: "ุชุทููุฑ ุงูููุงุฑุงุช",
                    evening: "ุงููุณุงุก", eveningDesc: "ุงุณุชูุนุงุจ ูููุงุฑุณุฉ", eveningTask: "ุชุญุณูู ุงููุบุฉ", endOfDay: "ููุงูุฉ ุงูููู", endOfDayDesc: "ูุฑุงุฌุนุฉ ูุชุฎุทูุท", endOfDayTask: "ุงูุชุฎุทูุท ููุบุฏ",
                    reportsTitle: "4. ุงูุชูุงุฑูุฑ", keysTitle: "5. ููุงุชูุญ ุงููุฌุงุญ", keyCommitment: "ุงูุงูุชุฒุงู", keyCommitmentDesc: "ุงูุงูุชุฒุงู ุจุงูุฎุทุฉ ููุฏุฉ ุฃุณุจูุนูู ุณูุฌุนููุง ุนุงุฏุฉ ููููุฉ ุณููุฉ.",
                    keyProjects: "ุงููุดุงุฑูุน", keyProjectsDesc: "ูุนุฑุถ ุฃุนูุงูู ุงูุชููู ูู ุฃููู ุฃุฏุงุฉ ูุฅุซุจุงุช ููุงุฑุงุชู.", keyShowcase: "ุงูุฅุธูุงุฑ", keyShowcaseDesc: "ุฃุซุจุช ููุงุฑุงุชู ุงูุชูุงุตููุฉ ูู ุฎูุงู ููู LinkedIn ุงุญุชุฑุงูู ููุญุชูู ูุงุฏู.",
                    keyFlexibility: "ุงููุฑููุฉ", keyFlexibilityDesc: "ุงูุฎุทุฉ ูู ุฅุทุงุฑ ุนูู ูููุณุช ูููุฏุงู. ูู ุจุชุนุฏูููุง ุญุณุจ ุงูุธุฑูู.", footer: "ุชู ุชุตููู ููุญุฉ ุงูุชุญูู ูุฐู ููุณุงุนุฏุชู ุนูู ุชูุธูู ุฑุญูุชู ุงูููููุฉ. ุจุงูุชูููู!",
                    priorityHigh: "ุนุงููุฉ", priorityMedium: "ูุชูุณุทุฉ", priorityLow: "ููุฎูุถุฉ", statusNotStarted: "ูู ุชุจุฏุฃ", statusInProgress: "ููุฏ ุงูุชูููุฐ", statusCompleted: "ููุชููุฉ",
                    noTasks: "ูุง ุชูุฌุฏ ููุงู ูุฌุฏููุฉ ููุฐุง ุงูููู. ุฃุถู ูููุฉ ุฌุฏูุฏุฉ!", weeklyChartLabels: ['ุงููุณุงุฑ ุงูุชููู (35%)','ุงููุณุงุฑ ุงูุชูุงุตูู (30%)','ุชุญุณูู ุงููุบุฉ (25%)','ุชุฎุทูุท ููุฑุงุฌุนุฉ (10%)'], taskChartLabels: ['ูู ุชุจุฏุฃ', 'ููุฏ ุงูุชูููุฐ', 'ููุชููุฉ'],
                    modalTitle: "ุฅุถุงูุฉ ูููุฉ ุฌุฏูุฏุฉ", modalTaskName: "ุงุณู ุงููููุฉ", modalCategory: "ุงููุฆุฉ", modalPriority: "ุงูุฃููููุฉ", modalAddTaskBtn: "ุฅุถุงูุฉ ุงููููุฉ",
                    toastTaskAdded: "ุชูุช ุฅุถุงูุฉ ุงููููุฉ ุจูุฌุงุญ!", toastTaskUpdated: "ุชู ุชุญุฏูุซ ุงููููุฉ!", toastTaskDeleted: "ุชู ุญุฐู ุงููููุฉ.", toastAIPriority: "ุชู ุชุญุฏูุซ ุงูุฃููููุงุช!", toastAISummary: "ุงูููุฎุต ุฌุงูุฒ!", toastAITasks: "ุชู ุชูููุฏ ุงูููุงู!", toastError: "ุญุฏุซ ุฎุทุฃ ูุง.",
                    aiGenerateBtn: "ุชูููุฏ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู", aiSummaryBtn: "ูุฎูุต ุฅูุฌุงุฒุงุชู", aiPriorityBtn: "ุงูุชุฑุญ ุงูุฃููููุงุช",
                    aiLoading: "ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูููุฑ...", aiSummaryTitle: "ููุฎุต ุฅูุฌุงุฒุงุชู", aiCloseBtn: "ุฅุบูุงู",
                    weeklyReportBtn: "ุชูุฑูุฑ ุฃุณุจูุนู", monthlyReportBtn: "ุชูุฑูุฑ ุดูุฑู", downloadPdfBtn: "ุชุญููู ูู PDF",
                    reportTitleWeekly: "ุงูุชูุฑูุฑ ุงูุฃุณุจูุนู", reportTitleMonthly: "ุงูุชูุฑูุฑ ุงูุดูุฑู", reportSummaryTitle: "ุงูููุฎุต",
                    reportTotal: "ุฅุฌูุงูู ุงูููุงู", reportCompleted: "ุงูููุงู ุงูููุชููุฉ", reportPending: "ุงูููุงู ุงููุชุจููุฉ",
                    reportDate: "ุชุงุฑูุฎ ุงูุชูุฑูุฑ", reportPeriod: "ุงููุชุฑุฉ", colDay: "ุงูููู", contactMe: "ุชูุงุตู ูุนู ุนุจุฑ ูุงุชุณุงุจ",
                    modalNotesTitle: "ููุงุญุธุงุช ุงููููุฉ", saveNotesBtn: "ุญูุธ ุงูููุงุญุธุงุช", toastNotesSaved: "ุชู ุญูุธ ุงูููุงุญุธุงุช.", dailyNotesTitle: "ููุงุญุธุงุช ุงูููู", toastDailyNotesSaved: "ุชู ุญูุธ ููุงุญุธุงุช ุงูููู.",
                    modalTaskDate: "ุงูุชุงุฑูุฎ", modalTaskTime: "ุงูููุช",
                    designedBy: "ุชู ุงูุชุตููู ุจูุงุณุทุฉ Ahmed Eltyeb Khalifa",
                    importBtn: "ุงุณุชูุฑุงุฏ", modalImportTitle: "ุงุณุชูุฑุงุฏ ุงูููุงู ูู CSV", importInstructions: "ุชุฃูุฏ ูู ุฃู ููู CSV ูุญุชูู ุนูู ุงูุฃุนูุฏุฉ ุงูุชุงููุฉ ุจุงูุชุฑุชูุจ: task, category, priority (high/medium/low), notes, date (YYYY-MM-DD), time (HH:MM).", selectFile: "ุงุฎุชุฑ ููู CSV", importTasksBtn: "ุงุณุชูุฑุงุฏ ุงูููุงู", toastImportSuccess: "ุชู ุงุณุชูุฑุงุฏ ุงูููุงู ุจูุฌุงุญ!", toastImportError: "ูุดู ุงุณุชูุฑุงุฏ ุงูููู. ุชุญูู ูู ุงูุชูุณูู."
                },
                en: {
                    langSwitch: "ุงูุนุฑุจูุฉ", mainTitle: "Interactive Professional Dashboard", mainSubtitle: "Your integrated plan to achieve your career goals efficiently and with focus.",
                    strategyTitle: "1. Strategic Analysis: The Two-Track Strategy", strategyDesc: "The biggest challenge is that your career goals are divided into two different fields. Therefore, the **\"Two-Track Strategy\"** was designed to present yourself as an expert in each field separately, significantly increasing your chances of success.",
                    techTrack: "Technical Track", techTrackDesc: "Focuses on roles like Software Developer & Application Administrator, requiring a technical CV and a strong portfolio.",
                    commTrack: "Communication Track", commTrackDesc: "Focuses on roles like Digital Marketing & Customer Service, requiring a CV that highlights communication and problem-solving skills.",
                    weeklyDistTitle: "Suggested Weekly Time Distribution", dashboardTitle: "2. Interactive Weekly Dashboard", dashboardDesc: "Here lies the power of your plan. Click on any day of the week to view your detailed plan and its dedicated tasks.",
                    selectDay: "Select a Day", monday: "Monday", tuesday: "Tuesday", wednesday: "Wednesday", thursday: "Thursday", friday: "Friday", saturday: "Saturday", sunday: "Sunday",
                    tasksList: "Tasks List:", colCompleted: "Done", colTask: "Task", colCategory: "Category", colPriority: "Priority", colStatus: "Status", colDelete: "Delete", colNotes: "Notes", colTime: "Time",
                    tasksAnalysis: "Tasks Analysis:", dailyStructureTitle: "3. Suggested Daily Structure", dailyStructureDesc: "This is the recommended daily workflow to make the most of your energy and focus throughout the day.",
                    morning: "Morning", morningDesc: "High energy & focus", morningTask: "Job Search", afternoon: "Afternoon", afternoonDesc: "Learning & applying", afternoonTask: "Skill Development",
                    evening: "Evening", eveningDesc: "Review & practice", eveningTask: "Language Improvement", endOfDay: "End of Day", endOfDayDesc: "Review & planning", endOfDayTask: "Plan for tomorrow",
                    reportsTitle: "4. Reports", keysTitle: "5. Keys to Success", keyCommitment: "Commitment", keyCommitmentDesc: "Sticking to the plan for two weeks will make it an easy daily habit.",
                    keyProjects: "Projects", keyProjectsDesc: "Your technical portfolio is the most powerful tool to prove your skills.", keyShowcase: "Showcasing", keyShowcaseDesc: "Demonstrate your communication skills with a professional LinkedIn profile and meaningful content.",
                    keyFlexibility: "Flexibility", keyFlexibilityDesc: "The plan is a framework, not a prison. Adjust it according to circumstances.", footer: "This dashboard was designed to help you organize your professional journey. Good luck!",
                    priorityHigh: "High", priorityMedium: "Medium", priorityLow: "Low", statusNotStarted: "Not Started", statusInProgress: "In Progress", statusCompleted: "Completed",
                    noTasks: "No tasks scheduled for this day. Add a new task!", weeklyChartLabels: ['Technical Track (35%)', 'Communication Track (30%)', 'Language Improvement (25%)', 'Planning & Review (10%)'], taskChartLabels: ['Not Started', 'In Progress', 'Completed'],
                    modalTitle: "Add a New Task", modalTaskName: "Task Name", modalCategory: "Category", modalPriority: "Priority", modalAddTaskBtn: "Add Task",
                    toastTaskAdded: "Task added successfully!", toastTaskUpdated: "Task updated!", toastTaskDeleted: "Task deleted.", toastAIPriority: "Priorities updated!", toastAISummary: "Summary is ready!", toastAITasks: "Tasks generated!", toastError: "An error occurred.",
                    aiGenerateBtn: "Generate with AI", aiSummaryBtn: "Summarize Achievements", aiPriorityBtn: "Suggest Priorities",
                    aiLoading: "AI is thinking...", aiSummaryTitle: "Your Achievement Summary", aiCloseBtn: "Close",
                    weeklyReportBtn: "Weekly Report", monthlyReportBtn: "Monthly Report", downloadPdfBtn: "Download as PDF",
                    reportTitleWeekly: "Weekly Report", reportTitleMonthly: "Monthly Report", reportSummaryTitle: "Summary",
                    reportTotal: "Total Tasks", reportCompleted: "Completed Tasks", reportPending: "Pending Tasks",
                    reportDate: "Report Date", reportPeriod: "Period", colDay: "Day", contactMe: "Contact me on WhatsApp",
                    modalNotesTitle: "Task Notes", saveNotesBtn: "Save Notes", toastNotesSaved: "Notes saved.", dailyNotesTitle: "Today's Notes", toastDailyNotesSaved: "Daily notes saved.",
                    modalTaskDate: "Date", modalTaskTime: "Time",
                    designedBy: "Designed by Ahmed Eltyeb Khalifa",
                    importBtn: "Import", modalImportTitle: "Import Tasks from CSV", importInstructions: "Ensure your CSV file has the following columns in order: task, category, priority (high/medium/low), notes, date (YYYY-MM-DD), time (HH:MM).", selectFile: "Select CSV File", importTasksBtn: "Import Tasks", toastImportSuccess: "Tasks imported successfully!", toastImportError: "File import failed. Check format."
                }
            };
            
            const langSwitcher = document.getElementById('lang-switcher');
            const daySelector = document.getElementById('day-selector');
            const planTitle = document.getElementById('plan-title');
            const tasksTableBody = document.getElementById('tasks-table-body');
            
            const modal = document.getElementById('add-task-modal');
            const addTaskBtn = document.getElementById('add-task-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const addTaskForm = document.getElementById('add-task-form');
            
            const notesModal = document.getElementById('notes-modal');
            const closeNotesModalBtn = document.getElementById('close-notes-modal-btn');
            const notesForm = document.getElementById('notes-form');
            const notesTaskIdInput = document.getElementById('notes-task-id');
            const taskNotesTextarea = document.getElementById('task-notes-textarea');
            
            const dailyNotesTextarea = document.getElementById('daily-notes-textarea');
            let dailyNotesDebounceTimer;

            const aiModal = document.getElementById('ai-modal');
            const aiLoading = document.getElementById('ai-loading');
            const aiSummaryContent = document.getElementById('ai-summary-content');
            const aiSummaryText = document.getElementById('ai-summary-text');
            const closeAiModalBtn = document.getElementById('close-ai-modal-btn');

            const aiGenerateTasksBtn = document.getElementById('ai-generate-tasks-btn');
            const aiPriorityBtn = document.getElementById('ai-priority-btn');
            const aiSummaryBtn = document.getElementById('ai-summary-btn');
            
            const themeToggleBtn = document.getElementById('theme-toggle');
            const toast = document.getElementById('toast-notification');
            const toastMessage = document.getElementById('toast-message');
            let toastTimeout;
            
            const reportModal = document.getElementById('report-modal');
            const reportModalTitle = document.getElementById('report-modal-title');
            const closeReportModalBtn = document.getElementById('close-report-modal-btn');
            const weeklyReportBtn = document.getElementById('weekly-report-btn');
            const monthlyReportBtn = document.getElementById('monthly-report-btn');
            const downloadPdfBtn = document.getElementById('download-pdf-btn');
            
            const importBtn = document.getElementById('import-btn');
            const importModal = document.getElementById('import-modal');
            const closeImportModalBtn = document.getElementById('close-import-modal-btn');
            const importForm = document.getElementById('import-form');
            const csvFileInput = document.getElementById('csv-file');


            function showToast(key, isError = false) {
                clearTimeout(toastTimeout);
                toastMessage.textContent = translations[currentLang][key];
                toast.classList.toggle('bg-red-500', isError);
                toast.classList.toggle('bg-green-500', !isError);
                toast.classList.remove('opacity-0', 'translate-y-20');
                toastTimeout = setTimeout(() => {
                    toast.classList.add('opacity-0', 'translate-y-20');
                }, 3000);
            }

            function updateThemeIcons(theme) {
                const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
                const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
                if (theme === 'dark') {
                    themeToggleLightIcon.classList.remove('hidden');
                    themeToggleDarkIcon.classList.add('hidden');
                } else {
                    themeToggleDarkIcon.classList.remove('hidden');
                    themeToggleLightIcon.classList.add('hidden');
                }
            }
            
            async function handleThemeToggle() {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                updateThemeIcons(isDark ? 'dark' : 'light');
                
                if (weeklyDistributionChart) {
                    weeklyDistributionChart.destroy();
                    createWeeklyChart();
                }
                
                if (taskAnalysisChart) {
                    try {
                        const tasksSnapshot = await db.collection('days').doc(currentDay).collection('tasks').get();
                        const tasks = tasksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        analyzeAndUpdateChart(tasks);
                    } catch (error) {
                        console.error("Error fetching tasks for chart update:", error);
                        analyzeAndUpdateChart([]); // Update with empty data on error
                    }
                }
            }
            
            themeToggleBtn.addEventListener('click', handleThemeToggle);


            function setLanguage(lang) {
                currentLang = lang;
                const dir = lang === 'ar' ? 'rtl' : 'ltr';
                document.documentElement.lang = lang;
                document.documentElement.dir = dir;

                document.querySelectorAll('[data-key]').forEach(element => {
                    const key = element.getAttribute('data-key');
                    if (translations[lang][key]) {
                        element.innerHTML = translations[lang][key];
                    }
                });
                
                const prioritySelect = document.getElementById('task-priority');
                prioritySelect.querySelector('[value="high"]').textContent = translations[lang].priorityHigh;
                prioritySelect.querySelector('[value="medium"]').textContent = translations[lang].priorityMedium;
                prioritySelect.querySelector('[value="low"]').textContent = translations[lang].priorityLow;


                langSwitcher.textContent = translations[lang].langSwitch;

                document.querySelectorAll('.direction-border').forEach(el => {
                    el.classList.toggle('border-r-4', lang === 'ar');
                    el.classList.toggle('border-l-4', lang === 'en');
                });
                document.querySelectorAll('.direction-text').forEach(el => {
                    el.classList.toggle('text-right', lang === 'ar');
                    el.classList.toggle('text-left', lang === 'en');
                });
                
                if (weeklyDistributionChart) weeklyDistributionChart.destroy();
                createWeeklyChart();
                
                setupFirestoreListener(currentDay);
            }

            function createWeeklyChart() {
                const weeklyChartCtx = document.getElementById('weeklyDistributionChart').getContext('2d');
                const fontColor = document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#4A4A4A';
                weeklyDistributionChart = new Chart(weeklyChartCtx, { type: 'doughnut', data: { labels: translations[currentLang].weeklyChartLabels, datasets: [{ label: 'Weekly Time Distribution', data: [ 35, 30, 25, 10 ], backgroundColor: ['#2563eb', '#3b82f6', '#9ca3af', '#d1d5db'], borderColor: document.documentElement.classList.contains('dark') ? '#1a202c' : '#ffffff', borderWidth: 4, hoverOffset: 8 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: fontColor, font: { family: currentLang === 'ar' ? 'Tajawal' : 'Readex Pro', size: 12 } } }, tooltip: { bodyFont: { family: currentLang === 'ar' ? 'Tajawal' : 'Readex Pro' }, titleFont: { family: currentLang === 'ar' ? 'Tajawal' : 'Readex Pro' } } }, cutout: '60%' } });
            }

            function createTaskChart() {
                const taskChartCtx = document.getElementById('taskAnalysisChart').getContext('2d');
                const fontColor = document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#4A4A4A';
                taskAnalysisChart = new Chart(taskChartCtx, { type: 'doughnut', data: { labels: translations[currentLang].taskChartLabels, datasets: [{ data: [0, 0, 0], backgroundColor: ['#9ca3af', '#f59e0b', '#10b981'], borderColor: document.documentElement.classList.contains('dark') ? '#1a202c' : '#ffffff', borderWidth: 4, hoverOffset: 4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true, position: 'bottom', labels: {color: fontColor, font: { family: currentLang === 'ar' ? 'Tajawal' : 'Readex Pro', size: 12 }}}, tooltip: { bodyFont: { family: currentLang === 'ar' ? 'Tajawal' : 'Readex Pro' }, titleFont: { family: currentLang === 'ar' ? 'Tajawal' : 'Readex Pro' } } }, cutout: '60%' } });
            }

            const getPriorityBadge = (priority) => {
                switch (priority) {
                    case 'high': return `bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300`;
                    case 'medium': return `bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300`;
                    case 'low': return `bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300`;
                    default: return 'bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-300';
                }
            };
            
            const getPriorityText = (priority) => {
                 const priorityKey = `priority${priority.charAt(0).toUpperCase() + priority.slice(1)}`;
                return translations[currentLang][priorityKey] || priority;
            }
             const getStatusText = (status) => {
                const statusKey = `status${status.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join('')}`;
                return translations[currentLang][statusKey] || status;
            }


            function analyzeAndUpdateChart(tasks = []) {
                const analysis = { not_started: 0, in_progress: 0, completed: 0 };
                tasks.forEach(task => {
                    analysis[task.status]++;
                });
                if(taskAnalysisChart) {
                    const fontColor = document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#4A4A4A';
                    taskAnalysisChart.data.datasets[0].data = [analysis.not_started, analysis.in_progress, analysis.completed];
                    taskAnalysisChart.data.datasets[0].borderColor = document.documentElement.classList.contains('dark') ? '#1a202c' : '#ffffff';
                    taskAnalysisChart.data.labels = translations[currentLang].taskChartLabels;
                    taskAnalysisChart.options.plugins.legend.labels.color = fontColor;
                    taskAnalysisChart.update();
                }
            }
            
            function renderTasks(tasks = []) {
                tasksTableBody.classList.add('opacity-0');
                
                setTimeout(() => {
                    planTitle.textContent = translations[currentLang][currentDay] + (currentLang === 'en' ? "'s Plan" : ": ุฎุทุฉ ููู");
                    tasksTableBody.innerHTML = ''; 

                    if (tasks && tasks.length > 0) {
                        tasks.forEach(task => {
                            const row = document.createElement('tr');
                            row.className = 'bg-white dark:bg-gray-800 border-b dark:border-gray-700';
                            row.dataset.taskId = task.id;
                            
                            const priorityText = getPriorityText(task.priority);
                            const priorityClass = getPriorityBadge(task.priority);

                            const createdAt = task.createdAt ? task.createdAt.toDate().toLocaleString(currentLang === 'ar' ? 'ar-EG' : 'en-US', { year: '2-digit', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : '...';

                            row.innerHTML = `
                                <td class="px-4 py-4"><div class="flex items-center justify-center"><input type="checkbox" ${task.completed ? 'checked' : ''} class="task-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600"></div></td>
                                <td class="px-6 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap">
                                    <span class="transition-all duration-300 ${task.completed ? 'line-through text-gray-400 dark:text-gray-500' : ''}">${task.task}</span>
                                </td>
                                <td class="px-2 py-4 text-center">
                                    <button class="view-notes-btn text-gray-400 hover:text-blue-500 dark:hover:text-blue-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" />
                                        </svg>
                                    </button>
                                </td>
                                <td class="px-6 py-4"><span class="text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full ${priorityClass}">${priorityText}</span></td>
                                <td class="px-6 py-4">
                                    <select class="task-status border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm p-1 bg-white dark:bg-gray-700 dark:text-gray-200">
                                        <option value="not_started" ${task.status === 'not_started' ? 'selected' : ''}>${getStatusText('not_started')}</option>
                                        <option value="in_progress" ${task.status === 'in_progress' ? 'selected' : ''}>${getStatusText('in_progress')}</option>
                                        <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>${getStatusText('completed')}</option>
                                    </select>
                                </td>
                                <td class="px-6 py-4 text-xs">${createdAt}</td>
                                 <td class="px-4 py-4">
                                    <button class="delete-task-btn text-gray-400 hover:text-red-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </td>
                            `;
                            tasksTableBody.appendChild(row);
                        });
                    } else {
                        tasksTableBody.innerHTML = `<tr><td colspan="7" class="text-center py-10 text-gray-500 dark:text-gray-400">${translations[currentLang].noTasks}</td></tr>`;
                    }
                    
                    document.querySelectorAll('.day-btn').forEach(button => {
                         button.classList.remove('active-day');
                         if(button.dataset.day === currentDay) { button.classList.add('active-day'); }
                    });
                    
                    analyzeAndUpdateChart(tasks);
                    tasksTableBody.classList.remove('opacity-0');
                }, 50);
            }

            async function setupFirestoreListener(day) {
                if (unsubscribe) {
                    unsubscribe(); 
                }
                
                // Fetch daily notes
                const dayDoc = await db.collection('days').doc(day).get();
                dailyNotesTextarea.value = dayDoc.data()?.dailyNotes || '';

                // Listen for task changes
                const tasksCollection = db.collection('days').doc(day).collection('tasks').orderBy('createdAt', 'desc');
                unsubscribe = tasksCollection.onSnapshot(snapshot => {
                    const tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderTasks(tasks);
                }, error => {
                    console.error("Error fetching tasks: ", error);
                    renderTasks([]);
                });
            }

            tasksTableBody.addEventListener('click', (e) => {
                const target = e.target;
                const deleteBtn = target.closest('.delete-task-btn');
                const notesBtn = target.closest('.view-notes-btn');

                if (deleteBtn) {
                    const row = deleteBtn.closest('tr');
                    const taskId = row.dataset.taskId;
                    if (confirm('Are you sure you want to delete this task?')) {
                         db.collection('days').doc(currentDay).collection('tasks').doc(taskId).delete()
                         .then(() => showToast('toastTaskDeleted'));
                    }
                }
                
                if (notesBtn) {
                    const row = notesBtn.closest('tr');
                    const taskId = row.dataset.taskId;
                    db.collection('days').doc(currentDay).collection('tasks').doc(taskId).get().then(doc => {
                        if (doc.exists) {
                            notesTaskIdInput.value = taskId;
                            taskNotesTextarea.value = doc.data().notes || '';
                            toggleModal(notesModal, true);
                        }
                    });
                }
            });

            tasksTableBody.addEventListener('change', (e) => {
                const target = e.target;
                const row = target.closest('tr');
                if (!row) return;
                
                const taskId = row.dataset.taskId;
                let dataToUpdate = {};

                if (target.classList.contains('task-checkbox')) {
                    dataToUpdate = { 
                        completed: target.checked, 
                        status: target.checked ? 'completed' : 'not_started' 
                    };
                }
                
                if (target.classList.contains('task-status')) {
                    const newStatus = target.value;
                    dataToUpdate = { 
                        status: newStatus, 
                        completed: newStatus === 'completed' 
                    };
                }

                if (Object.keys(dataToUpdate).length > 0) {
                     db.collection('days').doc(currentDay).collection('tasks').doc(taskId).update(dataToUpdate)
                     .then(() => showToast('toastTaskUpdated'));
                }
            });

            langSwitcher.addEventListener('click', () => {
                const newLang = currentLang === 'ar' ? 'en' : 'ar';
                setLanguage(newLang);
            });
            
            daySelector.addEventListener('click', function(e) {
                if (e.target.closest('.day-btn')) {
                    const selectedDay = e.target.closest('.day-btn').dataset.day;
                    currentDay = selectedDay;
                    setupFirestoreListener(currentDay);
                }
            });

            function toggleModal(modalElement, show) {
                if (show) {
                    modalElement.classList.remove('opacity-0', 'pointer-events-none');
                    modalElement.querySelector('.modal-content').classList.remove('scale-95');
                } else {
                    modalElement.classList.add('opacity-0', 'pointer-events-none');
                    modalElement.querySelector('.modal-content').classList.add('scale-95');
                }
            }
            
            addTaskBtn.addEventListener('click', () => {
                const now = new Date();
                const date = now.toISOString().split('T')[0];
                const time = now.toTimeString().split(' ')[0].substring(0, 5);
                document.getElementById('task-date').value = date;
                document.getElementById('task-time').value = time;
                toggleModal(modal, true)
            });
            closeModalBtn.addEventListener('click', () => toggleModal(modal, false));
            modal.addEventListener('click', (e) => { if (e.target === modal) toggleModal(modal, false); });

            addTaskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const taskName = document.getElementById('task-name').value;
                const taskCategory = document.getElementById('task-category').value;
                const taskNotes = document.getElementById('task-notes').value;
                const taskDate = document.getElementById('task-date').value;
                const taskTime = document.getElementById('task-time').value;
                const taskPriority = document.getElementById('task-priority').value;
                
                const combinedDateTime = new Date(`${taskDate}T${taskTime}`);
                const firestoreTimestamp = firebase.firestore.Timestamp.fromDate(combinedDateTime);

                const newTask = {
                    task: taskName, category: taskCategory, priority: taskPriority, notes: taskNotes,
                    status: 'not_started', completed: false,
                    createdAt: firestoreTimestamp
                };

                db.collection('days').doc(currentDay).collection('tasks').add(newTask)
                .then(() => showToast('toastTaskAdded'));

                addTaskForm.reset();
                toggleModal(modal, false);
            });
            
            // Notes Modal Logic
            closeNotesModalBtn.addEventListener('click', () => toggleModal(notesModal, false));
            notesModal.addEventListener('click', (e) => { if (e.target === notesModal) toggleModal(notesModal, false); });
            notesForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const taskId = notesTaskIdInput.value;
                const newNotes = taskNotesTextarea.value;
                
                db.collection('days').doc(currentDay).collection('tasks').doc(taskId).update({ notes: newNotes })
                .then(() => {
                    showToast('toastNotesSaved');
                    toggleModal(notesModal, false);
                });
            });
            
            // Daily Notes Logic
            dailyNotesTextarea.addEventListener('input', () => {
                clearTimeout(dailyNotesDebounceTimer);
                dailyNotesDebounceTimer = setTimeout(() => {
                    const notes = dailyNotesTextarea.value;
                    db.collection('days').doc(currentDay).set({ dailyNotes: notes }, { merge: true })
                    .then(() => showToast('toastDailyNotesSaved'));
                }, 1000);
            });


            // AI Features
            const API_KEY = "";
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            
            async function callGeminiAPI(prompt, jsonSchema = null) {
                const callGemini = firebase.functions().httpsCallable('callGeminiAPI');
                try {
                    const result = await callGemini({ prompt: prompt, jsonSchema: jsonSchema });
                    return result.data;
                } catch (error) {
                    console.error("Firebase Function call failed:", error);
                    showToast('toastError', true);
                    return null;
                }
            }
            
            aiGenerateTasksBtn.addEventListener('click', async () => {
                const goal = document.getElementById('task-name').value;
                if (!goal) return;

                toggleModal(modal, false);
                toggleModal(aiModal, true);
                aiLoading.classList.remove('hidden');
                aiSummaryContent.classList.add('hidden');
                
                const prompt = `Break down this high-level goal: "${goal}" into a list of specific, actionable tasks. Provide a relevant, single-word category for each task. Respond ONLY with a JSON array.`;
                const schema = {
                    type: "ARRAY",
                    items: {
                        type: "OBJECT",
                        properties: {
                            task: { type: "STRING" },
                            category: { type: "STRING" }
                        },
                        required: ["task", "category"]
                    }
                };
                const result = await callGeminiAPI(prompt, schema);
                
                toggleModal(aiModal, false);

                if (result) {
                    try {
                        const generatedTasks = JSON.parse(result);
                        const batch = db.batch();
                        generatedTasks.forEach(t => {
                            const docRef = db.collection('days').doc(currentDay).collection('tasks').doc();
                            batch.set(docRef, {
                                task: t.task, category: t.category, priority: 'medium', notes: '',
                                status: 'not_started', completed: false,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        });
                        await batch.commit();
                        showToast('toastAITasks');
                    } catch (e) {
                        console.error("Failed to parse AI response:", e);
                        showToast('toastError', true);
                    }
                }
            });
            
            aiPriorityBtn.addEventListener('click', async () => {
                const tasksSnapshot = await db.collection('days').doc(currentDay).collection('tasks').get();
                const tasks = tasksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (tasks.length === 0) return;

                toggleModal(aiModal, true);
                aiLoading.classList.remove('hidden');
                aiSummaryContent.classList.add('hidden');

                const taskTexts = tasks.map(t => ({ id: t.id, text: t.task }));
                const prompt = `Given this list of tasks as a JSON array, suggest a priority (high, medium, or low) for each. Respond ONLY with a JSON array with the same IDs. Tasks with keywords like 'deadline', 'urgent', 'prepare for meeting' should be high. Tasks related to 'learning', 'reading', 'research' are generally medium or low unless specified otherwise. Task list: ${JSON.stringify(taskTexts)}`;
                const schema = {
                    type: "ARRAY",
                    items: {
                        type: "OBJECT",
                        properties: {
                            id: { type: "STRING" },
                            priority: { type: "STRING", enum: ["high", "medium", "low"] }
                        },
                        required: ["id", "priority"]
                    }
                };
                
                const result = await callGeminiAPI(prompt, schema);
                toggleModal(aiModal, false);

                if (result) {
                    try {
                        const priorities = JSON.parse(result);
                        const batch = db.batch();
                        priorities.forEach(p => {
                            const docRef = db.collection('days').doc(currentDay).collection('tasks').doc(p.id);
                            batch.update(docRef, { priority: p.priority });
                        });
                        await batch.commit();
                        showToast('toastAIPriority');
                    } catch (e) {
                        console.error("Failed to parse AI priorities response:", e);
                        showToast('toastError', true);
                    }
                }
            });

            aiSummaryBtn.addEventListener('click', async () => {
                const tasksSnapshot = await db.collection('days').doc(currentDay).collection('tasks').where('completed', '==', true).get();
                const completedTasks = tasksSnapshot.docs.map(doc => doc.data().task);

                if (completedTasks.length === 0) {
                    showToast('noTasks', true);
                    return;
                }
                
                toggleModal(aiModal, true);
                aiLoading.classList.remove('hidden');
                aiSummaryContent.classList.add('hidden');

                const prompt = `I completed the following tasks today: ${completedTasks.join(', ')}. Write a short, motivational, and encouraging summary (2-3 sentences) of my achievements for the day. Address me directly as "you". The language of the summary must be ${currentLang === 'ar' ? 'Arabic' : 'English'}.`;
                
                const result = await callGeminiAPI(prompt);

                if (result) {
                    aiSummaryText.textContent = result;
                    aiLoading.classList.add('hidden');
                    aiSummaryContent.classList.remove('hidden');
                    showToast('toastAISummary');
                } else {
                    toggleModal(aiModal, false);
                }
            });

            closeAiModalBtn.addEventListener('click', () => toggleModal(aiModal, false));
            
            // Reports Features
            closeReportModalBtn.addEventListener('click', () => toggleModal(reportModal, false));
            reportModal.addEventListener('click', (e) => { if (e.target === reportModal) toggleModal(reportModal, false); });

            async function generateReport(period) {
                toggleModal(aiModal, true);
                aiLoading.classList.remove('hidden');
                aiSummaryContent.classList.add('hidden');
                
                const dayNames = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                let daysToFetch = [];
                let reportTitleKey;
                let startDate, endDate;

                const today = new Date();
                if (period === 'weekly') {
                    reportTitleKey = 'reportTitleWeekly';
                    const dayOfWeek = today.getDay();
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - dayOfWeek);
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);

                    let currentDate = new Date(startDate);
                    for (let i = 0; i < 7; i++) {
                        daysToFetch.push(dayNames[currentDate.getDay()]);
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                } else { // monthly
                    reportTitleKey = 'reportTitleMonthly';
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    daysToFetch = dayNames;
                }

                const promises = daysToFetch.map(day => 
                    db.collection('days').doc(day).collection('tasks').get()
                );
                
                const results = await Promise.all(promises);
                
                let allTasks = [];
                results.forEach((snapshot, index) => {
                    if (!snapshot.empty) {
                        snapshot.docs.forEach(doc => {
                            allTasks.push({ day: daysToFetch[index], ...doc.data() });
                        });
                    }
                });

                const completedTasks = allTasks.filter(t => t.completed).length;
                const pendingTasks = allTasks.length - completedTasks;
                
                const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
                const formattedStartDate = startDate.toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : 'en-US', dateOptions);
                const formattedEndDate = endDate.toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : 'en-US', dateOptions);

                let reportHTML = `<div class="p-4">`;
                reportHTML += `<h1 class="text-3xl font-bold mb-2">${translations[currentLang][reportTitleKey]}</h1>`;
                reportHTML += `<p class="text-sm text-gray-500 mb-4">${translations[currentLang].reportDate}: ${new Date().toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : 'en-US', dateOptions)}</p>`;
                reportHTML += `<p class="text-sm text-gray-500 mb-6">${translations[currentLang].reportPeriod}: ${formattedStartDate} - ${formattedEndDate}</p>`;
                
                reportHTML += `<h2 class="text-2xl font-bold mt-6 mb-3 border-b pb-2">${translations[currentLang].reportSummaryTitle}</h2>`;
                reportHTML += `<div class="grid grid-cols-3 gap-4 text-center">`;
                reportHTML += `<div><p class="text-2xl font-bold">${allTasks.length}</p><p class="text-sm text-gray-600">${translations[currentLang].reportTotal}</p></div>`;
                reportHTML += `<div><p class="text-2xl font-bold text-green-600">${completedTasks}</p><p class="text-sm text-gray-600">${translations[currentLang].reportCompleted}</p></div>`;
                reportHTML += `<div><p class="text-2xl font-bold text-yellow-600">${pendingTasks}</p><p class="text-sm text-gray-600">${translations[currentLang].reportPending}</p></div>`;
                reportHTML += `</div>`;

                reportHTML += `<h2 class="text-2xl font-bold mt-8 mb-4 border-b pb-2">${translations[currentLang].tasksList}</h2>`;
                reportHTML += `<table class="w-full text-left border-collapse">`;
                reportHTML += `<thead><tr class="bg-gray-100">
                    <th class="p-2 border">${translations[currentLang].colTask}</th>
                    <th class="p-2 border">${translations[currentLang].colDay}</th>
                    <th class="p-2 border">${translations[currentLang].colPriority}</th>
                    <th class="p-2 border">${translations[currentLang].colStatus}</th>
                    <th class="p-2 border">${translations[currentLang].colNotes}</th>
                    <th class="p-2 border">${translations[currentLang].colTime}</th>
                </tr></thead><tbody>`;

                allTasks.sort((a,b) => dayNames.indexOf(a.day) - dayNames.indexOf(b.day));

                allTasks.forEach(task => {
                     const createdAt = task.createdAt ? task.createdAt.toDate().toLocaleString(currentLang === 'ar' ? 'ar-EG' : 'en-US', { year: '2-digit', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : '';
                    reportHTML += `<tr class="border-b">
                        <td class="p-2 border">${task.task}</td>
                        <td class="p-2 border">${translations[currentLang][task.day]}</td>
                        <td class="p-2 border">${getPriorityText(task.priority)}</td>
                        <td class="p-2 border">${task.completed ? 'โ' : ''} ${getStatusText(task.status)}</td>
                        <td class="p-2 border">${task.notes || ''}</td>
                        <td class="p-2 border text-xs">${createdAt}</td>
                    </tr>`;
                });
                reportHTML += `</tbody></table></div>`;
                
                document.getElementById('report-content-to-print').innerHTML = reportHTML;
                reportModalTitle.textContent = translations[currentLang][reportTitleKey];

                toggleModal(aiModal, false);
                toggleModal(reportModal, true);
            }

            weeklyReportBtn.addEventListener('click', () => generateReport('weekly'));
            monthlyReportBtn.addEventListener('click', () => generateReport('monthly'));
            
            downloadPdfBtn.addEventListener('click', () => {
                const { jsPDF } = window.jspdf;
                const reportContent = document.getElementById('report-content-to-print');
                
                const tempContainer = document.createElement('div');
                tempContainer.className = 'pdf-styles';
                tempContainer.style.width = '210mm'; // A4 width
                tempContainer.style.padding = '20px';
                tempContainer.innerHTML = reportContent.innerHTML;
                document.body.appendChild(tempContainer);
                
                html2canvas(tempContainer, { scale: 2 }).then(canvas => {
                    document.body.removeChild(tempContainer);
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF({
                        orientation: 'p',
                        unit: 'mm',
                        format: 'a4'
                    });
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                    pdf.save('report.pdf');
                });

            });
            
            // Import Modal Logic
            importBtn.addEventListener('click', () => toggleModal(importModal, true));
            closeImportModalBtn.addEventListener('click', () => toggleModal(importModal, false));
            importModal.addEventListener('click', (e) => { if (e.target === importModal) toggleModal(importModal, false); });

            importForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const file = csvFileInput.files[0];
                if (!file) return;

                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: async (results) => {
                        try {
                            const tasksToImport = results.data;
                            const batch = db.batch();

                            tasksToImport.forEach(task => {
                                if (task.task && task.category && task.priority && task.date && task.time) {
                                    const combinedDateTime = new Date(`${task.date}T${task.time}`);
                                    const firestoreTimestamp = firebase.firestore.Timestamp.fromDate(combinedDateTime);
                                    
                                    const docRef = db.collection('days').doc(currentDay).collection('tasks').doc();
                                    batch.set(docRef, {
                                        task: task.task,
                                        category: task.category,
                                        priority: task.priority.toLowerCase(),
                                        notes: task.notes || '',
                                        status: 'not_started',
                                        completed: false,
                                        createdAt: firestoreTimestamp
                                    });
                                }
                            });

                            await batch.commit();
                            showToast('toastImportSuccess');
                            toggleModal(importModal, false);
                            importForm.reset();
                        } catch (error) {
                            console.error("Error importing tasks:", error);
                            showToast('toastImportError', true);
                        }
                    },
                    error: (error) => {
                        console.error("Error parsing CSV:", error);
                        showToast('toastImportError', true);
                    }
                });
            });


            // Initial Setup
            const currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            updateThemeIcons(currentTheme);
            createTaskChart();
            setLanguage('ar'); 
        });
    </script>
</body>
</html>

